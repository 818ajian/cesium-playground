<!DOCTYPE html>
<html lang="en">

<head>
  <!-- Use correct character set. -->
  <meta charset="utf-8">
  <link rel="shortcut icon" href="static/image/logo.png">
  <!-- Tell IE to use the latest, best version. -->
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <!-- Make the application on mobile take up the full browser screen and disable user scaling. -->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no">
  <title>3D underground tunnel | Earthbook</title>
  <script src="static/vendor/Cesium-1.50-trans/Build/Cesium/Cesium.js"></script>
  <style>
    @import url(static/vendor/Cesium-1.50-trans/Build/Cesium/Widgets/widgets.css);
    html,
    body,
    #cesiumContainer {
      width: 100%;
      height: 100%;
      margin: 0;
      padding: 0;
      overflow: hidden;
      position: relative;
    }

    #logo {
      z-index: 100;
      position: fixed;
      top: 86%;
      left: 5%;
      /*background-color: rgba(0, 0, 0, 0.5);*/
      width: 300px;
      padding: 5px;
    }

    .cesium-viewer-bottom,
    .cesium-viewer-animationContainer,
    .cesium-viewer-timelineContainer {
      display: none;
    }

    .tools {
      position: absolute;
      top: 20px;
      left: 20px;
      width: 100px;
      color: white;
    }
  </style>
</head>

<body>
  <img id="logo" src="static/image/logo.gif" style="z-index: 100; position: fixed; top: 86%; left: 5%; width: 300px;" />
  <div class="container">
    <div id="cesiumContainer">
    </div>
    <div class="tools">
      透明度
      <input id="btnImageryAlpha" type="range" min="0" max="10" value="10" step="0.1" oninput="change()" />
    </div>
  </div>
  <script>

    var tileset;

    // set up some fake tubes data
    // latitude range
    let latitudes = [24.972394, 25.040368];
    let longitudes = [121.422201, 121.493789];
    let heights = [-100, -20];
    let colors = [
      Cesium.Color.BLUE,
      Cesium.Color.RED,
      Cesium.Color.AZURE,
      Cesium.Color.LIGHTSEAGREEN,
      Cesium.Color.HOTPINK,
      Cesium.Color.KHAKI
    ];

    let setAmount = 500;
    let pointsPerSet = 4;


    let tubes = [
      {
        positions: [
          121.468749, 25.023525, -30,
          121.461298, 25.011312, -30,
          121.461298, 25.011312, -60
        ],
        color: Cesium.Color.BLUE
      }
    ];

    for (let i = 0; i < setAmount; i++) {
      let lon, lat;
      let h = getRandom(heights[0], heights[1]);
      let tube = {
        positions: [],
        color: colors[Math.ceil(Math.random() * colors.length) - 1]
      };
      for (let j = 0; j < pointsPerSet; j++) {
        if (j == 0) {
          lon = getRandom(longitudes[0], longitudes[1]);
          lat = getRandom(latitudes[0], latitudes[1]);
          tube.positions.push(lon, lat, h);
        } else if (j % 3 == 0) {
          lon = getRandom(longitudes[0], longitudes[1]);
          tube.positions.push(lon, lat, h);
        } else if (j % 3 == 1) {
          lat = getRandom(latitudes[0], latitudes[1]);
          tube.positions.push(lon, lat, h);
        } else if (j % 3 == 2) {
          h = getRandom(heights[0], heights[1]);
          tube.positions.push(lon, lat, h);
        }
      }
      tubes.push(tube);
    }

    function change() {
      var value = document.getElementById("btnImageryAlpha").value;
      if (viewer.imageryLayers) {
        for (var i = 0; i < viewer.imageryLayers.length; i++) {
          viewer.imageryLayers.get(i).alpha = value / 10;
        }
      }
    }

    function getRandom(min, max) {
      return Math.random() * (max - min) + min;
    }

    var viewer = new Cesium.Viewer('cesiumContainer', {
      skyAtmosphere: false,
      //baseLayerPicker: false,
      terrainProvider: Cesium.createWorldTerrain(),
      selectionIndicator: false
    });

    
    //change the ugly blue color to black
    viewer.scene.globe.baseColor = new Cesium.Color(0, 0, 0, 0);
    //default is 1
    //viewer.scene.globe.imageryLayers.get(0).alpha = 0.5;

    var modelMatrix = Cesium.Transforms.eastNorthUpToFixedFrame(
      Cesium.Cartesian3.fromDegrees(121.46375, 25.014353, 40));
    var model = viewer.scene.primitives.add(Cesium.Model.fromGltf({
      url: 'static/model/2-2a16970419eade79fa4080b57ca47ae9.gltf',
      modelMatrix: modelMatrix,
      scale: 1.0
    }));

    viewer.scene.screenSpaceCameraController.maximumZoomDistance = 8000;

    var center = Cesium.Cartesian3.fromDegrees(121.463644, 25.014261, 30);
    var heading = Cesium.Math.toRadians(0);
    var pitch = Cesium.Math.toRadians(-20.0);
    var range = 500.0;
    viewer.camera.lookAt(center, new Cesium.HeadingPitchRange(heading, pitch, range));

    setTimeout(function () {
      for (let i = 0; i < tubes.length; i++) {
        viewer.entities.add({
          name: '模擬管線編號 ' + i,
          polyline: {
            positions: Cesium.Cartesian3.fromDegreesArrayHeights(tubes[i].positions),
            width: 10,
            material: new Cesium.PolylineOutlineMaterialProperty({
              color: tubes[i].color,
              outlineWidth: 2,
              outlineColor: Cesium.Color.BLACK
            }),
            distanceDisplayCondition: new Cesium.DistanceDisplayCondition()
          }
        });
      }
    }, 6000);
  </script>
</body>

</html>